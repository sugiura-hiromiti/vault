---
id: 25042119455607
aliases:
  - what_is_abi_anyway
tags:
  - tech/abi
created: 250421 19:45:56
updated: 250421 20:33:17
---
[[RustとCにおける列挙型の違い]]
# 結論

どの様にバイナリを生成するかを定めたルール集

# dive in

ABIの解説でよくあるのは「主に関数の呼び方が定義されているもの」と言う説明
確かに間違ってはないが、だからどうした感が拭えない

この違和感の由来はそもそもバイナリレベルで関数の呼び出しがどう行われているのかイメージしづらいからだと思う
そこがイメージできる様な人はABIってなんだ..？ってならない
なので、身近な霊を用いてABIが何に影響を与えているのかを記す

# Alignment, Padding

Cだと構造体の各フィールドの配置はコード上で書かれている順になっている
alignmentは8（確か）

例えば以下の構造体は

```c
struct C {
	char: first_field;
	int: second_field;
	char: third_field;
}
```

メモリ上では各フィールドは構造体の開始アドレスから8の倍数のオフセットに配置される
これがC ABIのルール

rustの場合は最適化が施されるためまた異なった配置になる(恐らく4byte alignmentでfirst_field, third_field, second_fieldの順で配置される)
これはRust ABIのルールに則ってバイナリが生成されるから

このように、同じ構造体の表現だけでも色々なやり方がある
その色々な方法の中から一つピックアップして、「ウチはこの方法にします！」と宣言しているのがABI